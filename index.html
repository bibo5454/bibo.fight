<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>GALAXY COMMANDER: BIBO EDITION</title>
    <style>
        /* --- 1. CSS: STYLE & THEME --- */
        :root {
            --cyan: #00f2ff;
            --pink: #ff416c;
            --gold: #ffae00;
            --bg: #010105;
        }

        body {
            margin: 0; background: var(--bg); overflow: hidden;
            font-family: 'Segoe UI', sans-serif; color: white;
            touch-action: none; user-select: none; -webkit-user-select: none;
            width: 100vw; height: 100vh;
        }

        /* --- ÿ£ŸÖÿ± ŸÇŸÑÿ® ÿßŸÑÿ¥ÿßÿ¥ÿ© ÿ•ÿ¨ÿ®ÿßÿ±Ÿä ÿπŸÑŸâ ÿ¨ŸÖŸäÿπ ÿßŸÑŸáŸàÿßÿ™ŸÅ --- */
        #game-wrapper {
            width: 100%; height: 100%; position: relative;
        }

        @media screen and (orientation: portrait) {
            #game-wrapper {
                transform: rotate(90deg);
                transform-origin: left top;
                width: 100vh;
                height: 100vw;
                position: absolute;
                top: 0;
                left: 100%;
            }
        }

        canvas { display: block; width: 100%; height: 100%; }

        /* Ÿàÿßÿ¨Ÿáÿ© ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ (HUD) */
        #ui {
            position: absolute; top: 0; left: 0; width: 100%;
            padding: 15px; display: flex; justify-content: space-between;
            pointer-events: none; z-index: 100; box-sizing: border-box;
        }

        .stat-panel {
            background: rgba(255, 255, 255, 0.08); padding: 10px 15px;
            border-radius: 12px; border-right: 3px solid var(--cyan);
            backdrop-filter: blur(8px);
        }

        .label { font-size: 10px; color: var(--cyan); text-transform: uppercase; }
        .val { font-size: 20px; font-weight: bold; display: block; }
        #bibo-tag { font-size: 10px; color: var(--gold); margin-top: 5px; font-style: italic; }

        #hearts { font-size: 26px; color: var(--pink); text-shadow: 0 0 10px var(--pink); }

        /* --- 2. CONTROLS --- */
        #mobile-controls {
            position: absolute; bottom: 35px; left: 0; width: 100%;
            display: flex; justify-content: space-between; padding: 0 40px;
            box-sizing: border-box; z-index: 1000;
        }

        .move-group { display: flex; gap: 15px; }

        .btn {
            width: 75px; height: 75px; background: rgba(255, 255, 255, 0.1);
            border: 2px solid var(--cyan); border-radius: 18px;
            display: flex; align-items: center; justify-content: center;
            font-size: 30px; color: white; pointer-events: all;
            box-shadow: 0 0 15px rgba(0, 242, 255, 0.1);
        }

        #btn-l { transform: rotate(180deg); } 

        .btn:active {
            background: rgba(0, 242, 255, 0.3);
            transform: scale(0.9) translateY(4px);
        }

        #btn-fire {
            border-color: var(--pink); border-radius: 50%;
            background: rgba(255, 65, 108, 0.2);
        }

        #overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.9); display: none;
            flex-direction: column; align-items: center; justify-content: center;
            z-index: 2000;
        }

        .restart-btn {
            margin-top: 25px; padding: 12px 45px; background: var(--cyan);
            color: black; border: none; border-radius: 30px; font-weight: bold;
            font-size: 20px; cursor: pointer;
        }

        #line {
            position: absolute; width: 100%; height: 2px;
            background: linear-gradient(90deg, transparent, var(--pink), transparent);
            box-shadow: 0 0 10px var(--pink); opacity: 0.5; pointer-events: none;
        }
    </style>
</head>
<body>

<div id="game-wrapper">
    <div id="ui">
        <div class="stat-panel">
            <span class="label">SCORE</span>
            <span id="score-text" class="val">0</span>
            <span class="label">LEVEL</span>
            <span id="level-text" class="val">1</span>
            <div id="bibo-tag">Created by: BIBO</div>
        </div>
        <div id="hearts">‚ô•‚ô•‚ô•</div>
    </div>

    <div id="line"></div>

    <div id="overlay">
        <h1 style="color: var(--pink); font-size: 45px; margin: 0;">MISSION FAILED</h1>
        <p style="color: var(--gold); letter-spacing: 2px;">Created by BIBO, WE LOST THE BASE</p>
        <div class="stat-panel" style="text-align: center; border: none; border-bottom: 3px solid var(--cyan);">
            <span class="label">FINAL SCORE</span>
            <span id="final-score" class="val" style="font-size: 40px;">0</span>
        </div>
        <button class="restart-btn" onclick="location.reload()">RE-DEPLOY</button>
    </div>

    <div id="mobile-controls">
        <div class="move-group">
            <div class="btn" id="btn-l">‚û§</div>
            <div class="btn" id="btn-r">‚û§</div>
        </div>
        <div class="btn" id="btn-fire">üî•</div>
    </div>

    <canvas id="gameCanvas"></canvas>
</div>

<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');

let W, H, DEAD_ZONE;
function resize() {
    // ÿ™ÿπÿØŸäŸÑ ŸÑÿ≠ÿ≥ÿßÿ® ÿßŸÑÿ£ÿ®ÿπÿßÿØ ŸÅŸä ÿ≠ÿßŸÑÿ© ÿßŸÑÿØŸàÿ±ÿßŸÜ
    const rect = document.getElementById('game-wrapper').getBoundingClientRect();
    W = canvas.width = rect.width;
    H = canvas.height = rect.height;
    DEAD_ZONE = H - 150; // ÿ™ÿπÿØŸäŸÑ ÿ®ÿ≥Ÿäÿ∑ ŸÑŸÑŸÖŸÉÿßŸÜ ŸÅŸä Ÿàÿ∂ÿπ ÿßŸÑÿπÿ±ÿ∂
    document.getElementById('line').style.top = DEAD_ZONE + "px";
    if(player) { player.x = W/2; player.y = H-80; }
}
window.addEventListener('resize', resize);
window.addEventListener('orientationchange', resize);

let score = 0, level = 1, lives = 3, running = true;
let enemyDir = 1, frame = 0;
let fireRate = 300; 
let lastFireTime = 0;

const stars = [], pBullets = [], eBullets = [], enemies = [], sparks = [], drops = [];
const keys = { l: false, r: false };

for(let i=0; i<100; i++) stars.push({x: Math.random()*2000, y: Math.random()*2000, s: Math.random()*2, v: Math.random()*2 + 0.5});

class Ship {
    constructor() {
        this.w = 46; this.h = 40;
        this.x = W / 2; this.y = H - 80;
        this.speed = 10; this.shield = 0;
    }
    draw() {
        if(this.shield % 10 > 5) return;
        ctx.save();
        ctx.translate(this.x, this.y);
        ctx.shadowBlur = 20; ctx.shadowColor = '#00f2ff';
        ctx.fillStyle = '#00f2ff';
        ctx.beginPath();
        ctx.moveTo(0, -20); ctx.lineTo(-20, 15); ctx.lineTo(20, 15);
        ctx.fill();
        ctx.restore();
    }
    update() {
        if(keys.l && this.x > 30) this.x -= this.speed;
        if(keys.r && this.x < W - 30) this.x += this.speed;
        if(this.shield > 0) this.shield--;
    }
    shoot() {
        const now = Date.now();
        if(now - lastFireTime > fireRate) {
            pBullets.push({x: this.x, y: this.y - 20, v: -12});
            lastFireTime = now;
        }
    }
}

class Enemy {
    constructor(x, y, color, hasDrop) {
        this.x = x; this.y = y; this.color = color;
        this.hasDrop = hasDrop;
    }
    draw() {
        ctx.shadowBlur = 10; ctx.shadowColor = this.color;
        ctx.fillStyle = this.color;
        if(this.hasDrop) {
            ctx.strokeStyle = 'white'; ctx.lineWidth = 2;
            ctx.strokeRect(this.x - 17, this.y - 14, 34, 28);
        }
        ctx.fillRect(this.x - 15, this.y - 12, 30, 24);
    }
}

class PowerUp {
    constructor(x, y) {
        this.x = x; this.y = y; this.v = 3;
        this.color = '#ffae00';
    }
    draw() {
        ctx.shadowBlur = 15; ctx.shadowColor = this.color;
        ctx.fillStyle = this.color;
        ctx.beginPath();
        ctx.arc(this.x, this.y, 10, 0, Math.PI*2);
        ctx.fill();
        ctx.fillStyle = 'black';
        ctx.font = 'bold 12px Arial';
        ctx.fillText('P', this.x - 4, this.y + 4);
    }
    update() { this.y += this.v; }
}

let player;

function initLevel() {
    enemies.length = 0;
    let count = (level === 1) ? 10 : (level === 2) ? 18 : 24; 
    const cols = Math.floor(W / 60);
    const palette = ['#ff416c', '#00f2ff', '#ffae00'];
    let dropIdx1 = Math.floor(Math.random() * count);
    for(let i=0; i < count; i++) {
        let r = Math.floor(i / cols);
        let c = i % cols;
        enemies.push(new Enemy(c * 60 + 50, r * 45 + 70, palette[r % 3], i === dropIdx1));
    }
}

function handleCollisions() {
    pBullets.forEach((b, bi) => {
        enemies.forEach((e, ei) => {
            if(Math.hypot(b.x - e.x, b.y - e.y) < 22) {
                for(let i=0; i<8; i++) sparks.push({x: e.x, y: e.y, color: e.color, vx: (Math.random()-0.5)*10, vy: (Math.random()-0.5)*10, a: 1});
                if(e.hasDrop) drops.push(new PowerUp(e.x, e.y));
                enemies.splice(ei, 1); pBullets.splice(bi, 1);
                score += 100;
            }
        });
    });
    drops.forEach((d, di) => {
        if(Math.hypot(d.x - player.x, d.y - player.y) < 30) {
            drops.splice(di, 1);
            fireRate = 150; // ŸáÿØŸäÿ© ÿ®Ÿäÿ®Ÿà: ÿ∂ÿ±ÿ® ÿ≥ÿ±Ÿäÿπ ÿ¨ÿØÿßŸã
            score += 500;
        }
    });
    eBullets.forEach((eb, ebi) => {
        if(Math.hypot(eb.x - player.x, eb.y - player.y) < 22) {
            eBullets.splice(ebi, 1);
            if(player.shield === 0) {
                lives--; player.shield = 60;
                if(lives <= 0) endGame();
            }
        }
    });
}

function endGame() {
    running = false;
    document.getElementById('overlay').style.display = 'flex';
    document.getElementById('final-score').innerText = score;
}

function update() {
    if(!running) return;
    frame++;
    ctx.fillStyle = '#010105'; ctx.fillRect(0, 0, W, H);
    ctx.fillStyle = 'white';
    stars.forEach(s => { ctx.fillRect(s.x, s.y, s.s, s.s); s.y += s.v; if(s.y > H) s.y = 0; });

    player.update(); player.draw();

    let hitEdge = false;
    let speed = (2.5 + (level * 0.3)) * enemyDir;
    enemies.forEach(e => {
        e.x += speed;
        if(e.x > W - 25 || e.x < 25) hitEdge = true;
        if(Math.random() < 0.001 * level) eBullets.push({x: e.x, y: e.y, vy: 5});
    });

    if(hitEdge) {
        enemyDir *= -1;
        enemies.forEach(e => { e.y += 20; if(e.y >= DEAD_ZONE) endGame(); });
    }

    enemies.forEach(e => e.draw());
    pBullets.forEach((b, i) => { b.y += b.v; ctx.fillStyle = '#00f2ff'; ctx.fillRect(b.x-2, b.y, 4, 15); if(b.y < 0) pBullets.splice(i, 1); });
    eBullets.forEach((b, i) => { b.y += b.vy; ctx.fillStyle = '#ff416c'; ctx.fillRect(b.x-2, b.y, 4, 15); if(b.y > H) eBullets.splice(i, 1); });
    drops.forEach((d, i) => { d.update(); d.draw(); if(d.y > H) drops.splice(i, 1); });
    sparks.forEach((p, i) => {
        p.x += p.vx; p.y += p.vy; p.a -= 0.02;
        ctx.globalAlpha = p.a; ctx.fillStyle = p.color;
        ctx.fillRect(p.x, p.y, 3, 3); ctx.globalAlpha = 1;
        if(p.a <= 0) sparks.splice(i, 1);
    });

    handleCollisions();
    if(enemies.length === 0) { level++; initLevel(); }

    document.getElementById('score-text').innerText = score;
    document.getElementById('level-text').innerText = level;
    document.getElementById('hearts').innerText = "‚ô•".repeat(lives);

    requestAnimationFrame(update);
}

function setupControls() {
    const l = document.getElementById('btn-l'), r = document.getElementById('btn-r'), f = document.getElementById('btn-fire');
    const bind = (el, key) => {
        el.addEventListener('pointerdown', (e) => { e.preventDefault(); keys[key] = true; });
        el.addEventListener('pointerup', (e) => { e.preventDefault(); keys[key] = false; });
    };
    bind(l, 'l'); bind(r, 'r');
    f.addEventListener('pointerdown', (e) => { e.preventDefault(); if(running) player.shoot(); });
}

window.addEventListener('keydown', (e) => {
    if (e.key === 'ArrowLeft' || e.key === 'a') keys.l = true;
    if (e.key === 'ArrowRight' || e.key === 'd') keys.r = true;
    if (e.key === ' ') if(running) player.shoot();
});
window.addEventListener('keyup', (e) => {
    if (e.key === 'ArrowLeft' || e.key === 'a') keys.l = false;
    if (e.key === 'ArrowRight' || e.key === 'd') keys.r = false;
});

resize();
player = new Ship();
initLevel(); setupControls(); update();
</script>
</body>
</html>